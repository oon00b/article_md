<!DOCTYPE html><html lang="ja" dir="ltr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="https://creativecommons.org/licenses/by/4.0/" rel="license"><title>[macOS]USBメモリー内に.Spotlight-V100と.fseventsdを作らせないようにする</title><link href="../../../css/post.css" rel="stylesheet"><link href="../../../css/highlight.css" rel="stylesheet"></head><body><main class="main"><article class="post"><header class="post-header"><h1 class="post-title"><a href="../../../blog/2020/02/prevent-spotlightv100-fseventsd.html">[macOS]USBメモリー内に.Spotlight-V100と.fseventsdを作らせないようにする</a></h1><nav class="post-meta"><time class="post-date" datetime="2020-02-20">2020-02-20</time><span class="post-tags">tags: macOS</span></nav></header><div class="post-body"><p>macにUSBメモリーを繋いだ際に、メモリー内に<code>.Spotlight-V100/</code>や<code>.fseventsd/</code>のようなファイルが作られるが、邪魔なので阻止したい。色々調べてみたが、<code>.Spotlight-V100/</code>と<code>.fseventsd/</code>を作成しているプロセス(<code>mds</code>と<code>fseventsd</code>)を止める以外に方法が見つからなかったので、その方法をメモしておく。環境は<code>macOS 10.14.6</code></p><ol type="1"><li><a href="https://support.apple.com/ja-jp/HT201314">macOSをリカバリーモードで起動する</a>(電源を入れてから林檎マークが表示されるまで、<strong>command</strong>+<strong>R</strong>を押下する。)</li><li>ツールバーのユーティリティ-&gt;ターミナルを選択して起動。以下のコマンドを実行する。</li></ol><div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="ex">/usr/libexec/PlistBuddy</span> -c <span class="st">&quot;Add :Disabled bool true&quot;</span> /Volumes/Macintosh HD/System/Library/LaunchDaemons/com.apple.metadata.mds.plist</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="ex">/usr/libexec/PlistBuddy</span> -c <span class="st">&quot;Add :Disabled bool true&quot;</span> /Volumes/Macintosh HD/System/Library/LaunchDaemons/com.apple.fseventsd.plist</span></code></pre></div><p>再起動後、<code>sudo launchctl list | grep "metadata.mds\|fsevent"</code>で<code>mds</code>と<code>fseventsd</code>が止まっていることを確認。USBメモリーを何度か抜き差ししてテストしてみたが余計なファイルは作られなくなった。ただし、Spotlightや<a href="https://developer.apple.com/library/archive/documentation/Darwin/Conceptual/FSEvents_ProgGuide/Introduction/Introduction.html">File System Events</a>に依存したソフトウェアなどがうまく動かなくなるだろうが…</p><p>再び有効にする時はリカバリーモードで<code>/usr/libexec/PlistBuddy -c "Delete :Disabled" &lt;plistのパス&gt;</code>する。リカバリーモードでは<code>/</code>は<code>/Volumes/Macintosh HD/</code>では無いことを忘れないように</p><h2 id="他に試したこと">他に試したこと</h2><p>一旦<a href="https://developer.apple.com/library/archive/documentation/Security/Conceptual/System_Integrity_Protection_Guide/Introduction/Introduction.html">SIP</a>を無効にした上で<code>sudo launchctl unload</code>や<code>sudo launchctl bootout</code>したり<code>/var/db/com.apple.xpc.launchd/disabled.plist</code>を書き換えるという方法も試してみたが、再度SIPを有効にすると設定が元に戻るみたいなので、<code>/System/Library/LaunchDaemons/</code>以下のファイルを直接書き換えるか、SIPを無効のままにしておくしかないようだ。</p><h2 id="雑感">雑感</h2><p>プロセスごと止めるのはアレだが他に方法が見つからなかったのでしかたない。’リムーバブルメディア内にメタデータファイルを作成しないようにする’みたいな設定項目があればいいんだけど…</p><h2 id="参考">参考</h2><ul><li><code>man launchd</code></li><li><code>man launchctl</code></li><li><code>man launchd.plist</code></li><li><code>man PlistBuddy</code></li><li><a href="https://www.launchd.info">A launchd Tutorial</a></li></ul></div></article></main><footer class="footer">この文書は<a href="https://creativecommons.org/licenses/by/4.0/" rel="license">クリエイティブ・コモンズ 表示 4.0 国際 ライセンス</a>の下に提供されています。</footer></body></html>